# Telegram бот: 100 отжиманий в день

Бот для группового чата друзей (около 10 человек), чтобы отслеживать ежедневный челлендж на 100 отжиманий.

## Цели
- Упростить учет ежедневных отжиманий для каждого участника.
- Прозрачно показывать прогресс в группе.
- Закрывать дневной челлендж при достижении 100.

## Команды

### `add X`
Добавить `X` отжиманий за текущий день.

**Поведение:**
- Бот суммирует `X` с уже добавленным количеством за сегодня для пользователя.
- Если итог за сегодня **равен 100**, бот отвечает поздравлением и сообщает, что челлендж на сегодня закрыт.
- Если итог **превышает 100**, ничего дополнительно не делаем — просто считаем, что челлендж закрыт.

**Пример:**
- Было 40, пришло `add 20` → стало 60.
- Было 80, пришло `add 20` → стало 100 → бот поздравляет и закрывает день.

### `status`
Показать таблицу текущего статуса в чате за сегодня.

### `status DD.MM.YYYY`
Показать таблицу статуса за выбранный день.

**Поведение:**
- Если данные за указанную дату есть, вернуть таблицу.
- Если данных нет, сообщить, что результатов за этот день нет.

**Таблица должна включать:**
- участников, кто сегодня участвует в челлендже (сделал хотя бы один `add` за день);
- их промежуточные результаты;
- отметку, кто сегодня уже закрыл челлендж (достиг 100).
- результаты публичные для группы.

### `record`
Показать личные рекорды участников и общий рекорд чата с датами.

## Правила учета
- Учет ведется **по каждому пользователю** и **по каждому дню**.
- День считается по локальному времени чата/сервера.
- Ежедневные результаты сохраняются, чтобы можно было запрашивать историю.

## Ожидаемая логика хранения
- `user_id` → `date` → `count`
- При команде `add X` обновляется `count` за текущую дату.
- Данные не удаляются автоматически, используются для истории.

## Принятые решения
- Если сумма **превышает 100**, челлендж все равно считается закрытым, без дополнительных действий.
- “Участвующим сегодня” считается тот, кто сделал хотя бы один `add` за день.
- Результаты публичные для группы.

## Техническая реализация
- Бот: Telegram Bot API через `telegraf`
- Хранение: PostgreSQL (Railway Postgres)
- Даты: `dayjs`
- Режим работы: polling

## Запуск локально
1. Установить зависимости: `npm install`
2. Создать `.env` по образцу `.env.example`
3. Запустить: `npm start`

## Переменные окружения
- `BOT_TOKEN` — токен Telegram бота
- `DATABASE_URL` — строка подключения к Postgres
- `PGSSLMODE=disable` — опционально для локальной базы без SSL

## Деплой в Railway (polling)
1. Создать проект в Railway и подключить GitHub репозиторий.
2. Добавить **Postgres** к проекту (New → Database → Postgres).
3. В разделе **Variables** добавить:
   - `BOT_TOKEN`
   - `DATABASE_URL` (Railway добавит автоматически при подключении Postgres)
4. В разделе **Deployments** убедиться, что команда запуска: `npm start`.

**Важно:** токен хранится только в переменных окружения Railway и не должен попадать в репозиторий.

