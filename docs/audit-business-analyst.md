# Аудит приложения G8 Adjumannya — бизнес-аналитик

Документ предлагает **идеи развития** и **конкретные фичи** на основе описания данных и технических концепций из [audit-system-analyst.md](./audit-system-analyst.md).

---

## Исходные предпосылки (из системного аудита)

- Есть **пользователи**, **подходы** (отжимания по дням), **чаты** и связка «кто в каком чате виден» (**shared_chats**).
- Уже есть: статус за день, рекорды (лучший подход, лучший день), история по дням, календарь, редактирование/удаление подходов.
- Авторизация: бот по контексту, API v2 по JWT (user_id); для статуса/рекордов по чату передаётся chat_id с проверкой доступа.

Ниже — идеи и фичи, сгруппированные по направлению.

---

## 1. Удержание и мотивация

### 1.1 Серии (streaks)

**Идея:** показывать пользователю, сколько дней подряд он выполнял норму (например, ≥ 100 отжиманий).

**Данные:** производные от существующих: по `daily_adds` для user_id считаем сумму по каждому дню, затем «текущая серия» и «лучшая серия».

**Фича:**  
- В API: например, `GET /api/v2/me/stats` или расширение ответа истории — поля `current_streak`, `best_streak`.  
- В WebApp: блок «Серия: N дней» и «Лучшая серия: M дней» на главном экране или в статистике.

**Сложность:** низкая (только агрегация по уже имеющимся данным).

---

### 1.2 Напоминания и цели на день

**Идея:** пользователь ставит цель на день (100 или своё число); бот или WebApp напоминает, если к вечеру цель не достигнута.

**Данные:** новая сущность «цель пользователя на день» (например, user_id, date, target_count) или одна настройка «дневная цель» (user_id, target_count). Напоминания — по расписанию (cron/очередь) с учётом текущего итога за день из `daily_adds`.

**Фича:**  
- Настройка цели в WebApp или в боте (`/goal 100`).  
- Опционально: push/напоминание в Telegram (бот отправляет сообщение в ЛС), если к 21:00 сумма за день &lt; цели.

**Сложность:** средняя (настройки, расписание, возможно хранение времени напоминания по пользователю).

---

### 1.3 Достижения (badges)

**Идея:** «Значки» за достижения: первый день 100, 7 дней подряд, 1000 за неделю, лучший подход 50+ и т.д.

**Данные:** производные от `daily_adds` и истории; при желании — таблица «выданные достижения» (user_id, badge_id, earned_at) для стойкости и отображения в профиле.

**Фича:**  
- В WebApp: раздел «Достижения» с прогрессом (например, «5/7 дней подряд»).  
- В боте: команда `/achievements` или кнопка в меню.

**Сложность:** средняя (логика условий + при желании хранение выданных badges).

---

## 2. Социальность и конкуренция

### 2.1 «Мои чаты» и выбор чата в WebApp

**Идея:** в v2 сейчас chat_id приходит только из URL при открытии WebApp из бота. Добавить явный список чатов, в которых пользователь состоит (shared_chats), и возможность переключать чат в интерфейсе.

**Данные:** уже есть — `shared_chats` по user_id. Нужен эндпоинт вида `GET /api/v2/chats` (список chat_id, где user_id участник), без раскрытия других участников при необходимости.

**Фича:**  
- API: `GET /api/v2/chats` → список чатов (например, chat_id + опционально метка «текущий» из start_param).  
- WebApp: переключатель «Чат» в шапке или настройках; при смене чата перезапрашиваются status и records по выбранному chat_id.

**Сложность:** низкая при наличии shared_chats.

---

### 2.2 Сравнение с другим участником чата

**Идея:** «Сравнить меня с X» — общий календарь или график за месяц: я vs выбранный участник (суммы по дням).

**Данные:** два user_id из одного чата (проверка через shared_chats); история по дням из `daily_adds` для обоих — уже есть формат в GET /api/v2/history. Ограничение: только участники того же чата.

**Фича:**  
- API: например, `GET /api/v2/compare?user_id=...&date_from=...&date_to=...` (второй user_id = req.userId), с проверкой, что оба в одном чате.  
- WebApp: выбор участника из списка чата + общий календарь/график «я / он».

**Сложность:** низкая–средняя.

---

### 2.3 Публичный лидерборд за период

**Идея:** не только «рекорды вообще», но и «кто больше всего отжиманий за неделю/месяц» в рамках чата.

**Данные:** участники чата из shared_chats; по `daily_adds` за выбранный диапазон дат SUM(count) по user_id; сортировка по убыванию суммы.

**Фича:**  
- API: `GET /api/v2/leaderboard?chat_id=...&from=...&to=...` (например, неделя/месяц).  
- WebApp и бот: «Лидер недели» / «Лидер месяца» рядом с общими рекордами.

**Сложность:** низкая.

---

## 3. Гибкость продукта

### 3.1 Настраиваемая дневная норма

**Идея:** не только 100, а у каждого своя цель (50, 100, 150…) для челленджа и отображения «норма выполнена».

**Данные:** настройка на пользователя (user_id, target_per_day); при отображении статуса и серий использовать эту цель вместо константы 100.

**Фича:**  
- В настройках WebApp или боте: «Цель в день: N».  
- В статусе за день: «80/100» или «80/50» (если цель 50); серии считать по «день ≥ цели пользователя».

**Сложность:** низкая при хранении одной настройки на пользователя.

---

### 3.2 Второй тип упражнения (например, приседания)

**Идея:** те же чаты и пользователи, но второй счётчик — «приседания в день» с той же механикой (подходы, рекорды, статус за день).

**Данные:** отдельная таблица подходов по типу упражнения (например, `daily_adds_squats` с той же структурой) или поле `exercise_type` в одной таблице. Рекорды и статус считаются по типу.

**Фича:**  
- В боте: `/add_squats 20` или выбор «отжимания / приседания» в WebApp.  
- Отдельные вкладки или фильтры: «Отжимания» / «Приседания» (статус, рекорды, календарь).

**Сложность:** высокая (расширение модели данных и всех агрегатов).

---

## 4. Качество данных и удобство

### 4.1 Экспорт своих данных

**Идея:** пользователь может скачать историю своих подходов (CSV/JSON) для бэкапа или анализа.

**Данные:** уже есть GET /api/v2/approaches и GET /api/v2/history; достаточно агрегировать по user_id за период и отдать файлом.

**Фича:**  
- API: `GET /api/v2/export?format=csv|json&from=...&to=...` (только свой user_id).  
- WebApp: кнопка «Скачать мои данные» в настройках или в блоке статистики.

**Сложность:** низкая.

---

### 4.2 Подтверждение при удалении подхода

**Идея:** в WebApp при удалении подхода показывать диалог «Удалить подход N отжиманий?», чтобы снизить случайные удаления.

**Данные:** не требуют изменений.

**Фича:** модальное окно или confirm перед вызовом DELETE /api/v2/approaches/:id.

**Сложность:** очень низкая.

---

### 4.3 Недельный/месячный отчёт в боте

**Идея:** раз в неделю (или по команде) бот присылает в ЛС или в чат сводку: «За неделю: всего N отжиманий, дней с нормой: K, лучший день: дата — M».

**Данные:** агрегация по `daily_adds` за период для участников чата или для одного пользователя.

**Фича:**  
- Команда `/report_week` или `/report_month` в боте.  
- Опционально: еженедельная рассылка в ЛС (по подписке пользователя).

**Сложность:** низкая для команды; средняя при автоматической рассылке (очередь, настройки).

---

## 5. Приоритизация (сводная таблица)

| Фича | Польза для пользователя | Сложность | Зависимости |
|------|-------------------------|-----------|-------------|
| Серии (streaks) | Высокая (мотивация) | Низкая | Нет |
| «Мои чаты» в WebApp | Высокая (удобство v2) | Низкая | GET /api/v2/chats |
| Настраиваемая норма в день | Высокая (гибкость) | Низкая | Настройка target_per_day |
| Лидерборд за период (неделя/месяц) | Средняя (соревнование) | Низкая | Нет |
| Экспорт данных | Средняя (контроль данных) | Низкая | Нет |
| Достижения (badges) | Средняя (игрофикация) | Средняя | Опционально таблица badges |
| Напоминания / цели на день | Средняя (дисциплина) | Средняя | Цели, расписание |
| Сравнение с участником чата | Средняя (социальность) | Низкая–средняя | Один новый эндпоинт |
| Недельный отчёт в боте | Средняя (обратная связь) | Низкая | Нет |
| Подтверждение при удалении подхода | Низкая (безопасность) | Очень низкая | Нет |
| Второй тип упражнения | Высокая при запросе | Высокая | Расширение схемы и логики |

Рекомендуется начать с **серий**, **«мои чаты»** и **настраиваемой нормы** — максимум пользы при минимальных изменениях в текущей модели данных из аудита системного аналитика.
